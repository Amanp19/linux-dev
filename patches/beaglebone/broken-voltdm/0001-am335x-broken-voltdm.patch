From fefab7779bb81451b067c0661ee5b18bc74fd8e3 Mon Sep 17 00:00:00 2001
From: Robert Nelson <robertcnelson@gmail.com>
Date: Thu, 28 Jan 2016 10:35:37 -0600
Subject: [PATCH] am335x broken voltdm

Signed-off-by: Robert Nelson <robertcnelson@gmail.com>
---
 arch/arm/boot/dts/am335x-abbbi.dts                 |  1 +
 arch/arm/boot/dts/am335x-arduino-tre.dts           |  1 +
 arch/arm/boot/dts/am335x-bbb-broken-voltdm.dtsi    | 27 ++++++++++++++++++++++
 arch/arm/boot/dts/am335x-boneblack-bbb-exp-c.dts   |  1 +
 arch/arm/boot/dts/am335x-boneblack-bbb-exp-r.dts   |  1 +
 arch/arm/boot/dts/am335x-boneblack-bbbmini.dts     |  1 +
 .../boot/dts/am335x-boneblack-cape-bone-argus.dts  |  1 +
 .../arm/boot/dts/am335x-boneblack-emmc-overlay.dts |  1 +
 .../arm/boot/dts/am335x-boneblack-hdmi-overlay.dts |  1 +
 .../boot/dts/am335x-boneblack-nhdmi-overlay.dts    |  1 +
 arch/arm/boot/dts/am335x-boneblack-overlay.dts     |  1 +
 arch/arm/boot/dts/am335x-boneblack-wl1835mod.dts   |  1 +
 arch/arm/boot/dts/am335x-boneblack.dts             |  1 +
 arch/arm/boot/dts/am335x-bonegreen-overlay.dts     |  1 +
 arch/arm/boot/dts/am335x-bonegreen-wireless.dts    |  1 +
 arch/arm/boot/dts/am335x-bonegreen.dts             |  1 +
 16 files changed, 42 insertions(+)
 create mode 100644 arch/arm/boot/dts/am335x-bbb-broken-voltdm.dtsi

diff --git a/arch/arm/boot/dts/am335x-abbbi.dts b/arch/arm/boot/dts/am335x-abbbi.dts
index cc9b1f4..e7aac54 100644
--- a/arch/arm/boot/dts/am335x-abbbi.dts
+++ b/arch/arm/boot/dts/am335x-abbbi.dts
@@ -11,6 +11,7 @@
 #include "am33xx.dtsi"
 #include "am335x-bone-common.dtsi"
 #include "am33xx-overlay-edma-fix.dtsi"
+#include "am335x-bbb-broken-voltdm.dtsi"
 
 / {
 	model = "Arrow BeagleBone Black Industrial";
diff --git a/arch/arm/boot/dts/am335x-arduino-tre.dts b/arch/arm/boot/dts/am335x-arduino-tre.dts
index 9e27df0..5b91487 100644
--- a/arch/arm/boot/dts/am335x-arduino-tre.dts
+++ b/arch/arm/boot/dts/am335x-arduino-tre.dts
@@ -8,6 +8,7 @@
 /dts-v1/;
 
 #include "am33xx.dtsi"
+#include "am335x-bbb-broken-voltdm.dtsi"
 
 / {
 	model = "TI AM335x Arduino Tre";
diff --git a/arch/arm/boot/dts/am335x-bbb-broken-voltdm.dtsi b/arch/arm/boot/dts/am335x-bbb-broken-voltdm.dtsi
new file mode 100644
index 0000000..1fb10a0
--- /dev/null
+++ b/arch/arm/boot/dts/am335x-bbb-broken-voltdm.dtsi
@@ -0,0 +1,27 @@
+/*
+ * Copyright (C) 2012 Texas Instruments Incorporated - http://www.ti.com/
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License version 2 as
+ * published by the Free Software Foundation.
+ */
+
+/ {
+	cpus {
+		cpu@0 {
+			cpu0-supply = <&dcdc2_reg>;
+			/*
+			 * To consider voltage drop between PMIC and SoC,
+			 * tolerance value is reduced to 2% from 4% and
+			 * voltage value is increased as a precaution.
+			 */
+			operating-points = <
+				/* kHz    uV */
+				1000000	1325000
+				800000	1300000
+				600000	1112000
+				300000	969000
+			>;
+		};
+	};
+};
diff --git a/arch/arm/boot/dts/am335x-boneblack-bbb-exp-c.dts b/arch/arm/boot/dts/am335x-boneblack-bbb-exp-c.dts
index 938a26a..55238fb 100644
--- a/arch/arm/boot/dts/am335x-boneblack-bbb-exp-c.dts
+++ b/arch/arm/boot/dts/am335x-boneblack-bbb-exp-c.dts
@@ -9,6 +9,7 @@
 
 #include "am33xx.dtsi"
 #include "am335x-bone-common-no-capemgr.dtsi"
+#include "am335x-bbb-broken-voltdm.dtsi"
 
 / {
 	model = "TI AM335x BeagleBone Black";
diff --git a/arch/arm/boot/dts/am335x-boneblack-bbb-exp-r.dts b/arch/arm/boot/dts/am335x-boneblack-bbb-exp-r.dts
index 6cf786f..1deece5 100644
--- a/arch/arm/boot/dts/am335x-boneblack-bbb-exp-r.dts
+++ b/arch/arm/boot/dts/am335x-boneblack-bbb-exp-r.dts
@@ -9,6 +9,7 @@
 
 #include "am33xx.dtsi"
 #include "am335x-bone-common-no-capemgr.dtsi"
+#include "am335x-bbb-broken-voltdm.dtsi"
 
 / {
 	model = "TI AM335x BeagleBone Black";
diff --git a/arch/arm/boot/dts/am335x-boneblack-bbbmini.dts b/arch/arm/boot/dts/am335x-boneblack-bbbmini.dts
index adb317c..5dd5d40 100644
--- a/arch/arm/boot/dts/am335x-boneblack-bbbmini.dts
+++ b/arch/arm/boot/dts/am335x-boneblack-bbbmini.dts
@@ -10,6 +10,7 @@
 
 #include "am33xx.dtsi"
 #include "am335x-bone-common.dtsi"
+#include "am335x-bbb-broken-voltdm.dtsi"
 
 #include <dt-bindings/board/am335x-bbw-bbb-base.h>
 #include <dt-bindings/pinctrl/am33xx.h>
diff --git a/arch/arm/boot/dts/am335x-boneblack-cape-bone-argus.dts b/arch/arm/boot/dts/am335x-boneblack-cape-bone-argus.dts
index cecb0fcc..6ec2ea8 100644
--- a/arch/arm/boot/dts/am335x-boneblack-cape-bone-argus.dts
+++ b/arch/arm/boot/dts/am335x-boneblack-cape-bone-argus.dts
@@ -9,6 +9,7 @@
 
 #include "am33xx.dtsi"
 #include "am335x-bone-common-no-capemgr.dtsi"
+#include "am335x-bbb-broken-voltdm.dtsi"
 
 / {
 	model = "TI AM335x BeagleBone Black";
diff --git a/arch/arm/boot/dts/am335x-boneblack-emmc-overlay.dts b/arch/arm/boot/dts/am335x-boneblack-emmc-overlay.dts
index 5946a7e..33a8a0e 100644
--- a/arch/arm/boot/dts/am335x-boneblack-emmc-overlay.dts
+++ b/arch/arm/boot/dts/am335x-boneblack-emmc-overlay.dts
@@ -10,6 +10,7 @@
 #include "am33xx.dtsi"
 #include "am335x-bone-common.dtsi"
 #include "am33xx-overlay-edma-fix.dtsi"
+#include "am335x-bbb-broken-voltdm.dtsi"
 
 / {
 	model = "TI AM335x BeagleBone Black";
diff --git a/arch/arm/boot/dts/am335x-boneblack-hdmi-overlay.dts b/arch/arm/boot/dts/am335x-boneblack-hdmi-overlay.dts
index 9b0a7ba..2eb0253 100644
--- a/arch/arm/boot/dts/am335x-boneblack-hdmi-overlay.dts
+++ b/arch/arm/boot/dts/am335x-boneblack-hdmi-overlay.dts
@@ -10,6 +10,7 @@
 #include "am33xx.dtsi"
 #include "am335x-bone-common.dtsi"
 #include "am33xx-overlay-edma-fix.dtsi"
+#include "am335x-bbb-broken-voltdm.dtsi"
 
 / {
 	model = "TI AM335x BeagleBone Black";
diff --git a/arch/arm/boot/dts/am335x-boneblack-nhdmi-overlay.dts b/arch/arm/boot/dts/am335x-boneblack-nhdmi-overlay.dts
index 9b0a7ba..2eb0253 100644
--- a/arch/arm/boot/dts/am335x-boneblack-nhdmi-overlay.dts
+++ b/arch/arm/boot/dts/am335x-boneblack-nhdmi-overlay.dts
@@ -10,6 +10,7 @@
 #include "am33xx.dtsi"
 #include "am335x-bone-common.dtsi"
 #include "am33xx-overlay-edma-fix.dtsi"
+#include "am335x-bbb-broken-voltdm.dtsi"
 
 / {
 	model = "TI AM335x BeagleBone Black";
diff --git a/arch/arm/boot/dts/am335x-boneblack-overlay.dts b/arch/arm/boot/dts/am335x-boneblack-overlay.dts
index 880629c..b8daf01 100644
--- a/arch/arm/boot/dts/am335x-boneblack-overlay.dts
+++ b/arch/arm/boot/dts/am335x-boneblack-overlay.dts
@@ -10,6 +10,7 @@
 #include "am33xx.dtsi"
 #include "am335x-bone-common.dtsi"
 #include "am33xx-overlay-edma-fix.dtsi"
+#include "am335x-bbb-broken-voltdm.dtsi"
 
 / {
 	model = "TI AM335x BeagleBone Black";
diff --git a/arch/arm/boot/dts/am335x-boneblack-wl1835mod.dts b/arch/arm/boot/dts/am335x-boneblack-wl1835mod.dts
index e376613..60cdc98 100644
--- a/arch/arm/boot/dts/am335x-boneblack-wl1835mod.dts
+++ b/arch/arm/boot/dts/am335x-boneblack-wl1835mod.dts
@@ -9,6 +9,7 @@
 
 #include "am33xx.dtsi"
 #include "am335x-bone-common-no-capemgr.dtsi"
+#include "am335x-bbb-broken-voltdm.dtsi"
 
 / {
 	model = "TI AM335x BeagleBone Black";
diff --git a/arch/arm/boot/dts/am335x-boneblack.dts b/arch/arm/boot/dts/am335x-boneblack.dts
index db5beb5..6d77d2e 100644
--- a/arch/arm/boot/dts/am335x-boneblack.dts
+++ b/arch/arm/boot/dts/am335x-boneblack.dts
@@ -10,6 +10,7 @@
 #include "am33xx.dtsi"
 #include "am335x-bone-common.dtsi"
 #include "am33xx-overlay-edma-fix.dtsi"
+#include "am335x-bbb-broken-voltdm.dtsi"
 
 / {
 	model = "TI AM335x BeagleBone Black";
diff --git a/arch/arm/boot/dts/am335x-bonegreen-overlay.dts b/arch/arm/boot/dts/am335x-bonegreen-overlay.dts
index b87a606..14f3431 100644
--- a/arch/arm/boot/dts/am335x-bonegreen-overlay.dts
+++ b/arch/arm/boot/dts/am335x-bonegreen-overlay.dts
@@ -10,6 +10,7 @@
 #include "am33xx.dtsi"
 #include "am335x-bone-common.dtsi"
 #include "am33xx-overlay-edma-fix.dtsi"
+#include "am335x-bbb-broken-voltdm.dtsi"
 
 / {
 	model = "TI AM335x BeagleBone Green";
diff --git a/arch/arm/boot/dts/am335x-bonegreen-wireless.dts b/arch/arm/boot/dts/am335x-bonegreen-wireless.dts
index 788a2bd..0da0331 100644
--- a/arch/arm/boot/dts/am335x-bonegreen-wireless.dts
+++ b/arch/arm/boot/dts/am335x-bonegreen-wireless.dts
@@ -10,6 +10,7 @@
 #include "am33xx.dtsi"
 #include "am335x-bone-common.dtsi"
 #include "am335x-bonegreen-wl1835.dtsi"
+#include "am335x-bbb-broken-voltdm.dtsi"
 
 / {
 	model = "TI AM335x BeagleBone Green";
diff --git a/arch/arm/boot/dts/am335x-bonegreen.dts b/arch/arm/boot/dts/am335x-bonegreen.dts
index 42ac698..8bf93e6 100644
--- a/arch/arm/boot/dts/am335x-bonegreen.dts
+++ b/arch/arm/boot/dts/am335x-bonegreen.dts
@@ -10,6 +10,7 @@
 #include "am33xx.dtsi"
 #include "am335x-bone-common.dtsi"
 #include "am33xx-overlay-edma-fix.dtsi"
+#include "am335x-bbb-broken-voltdm.dtsi"
 
 / {
 	model = "TI AM335x BeagleBone Green";
-- 
2.7.0.rc3

